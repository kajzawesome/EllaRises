<%- include('../partials/header', { title: 'Manage Event' }) %>

<div class="admin-container">

  <!-- Sidebar -->
  <aside class="admin-sidebar">
      <h3><span class="lang-en">Admin Tools</span><span class="lang-es">Herramientas Admin</span></h3>

      <a class="admin-btn" href="/admin/dashboard"><span class="lang-en">Dashboard</span><span class="lang-es">Panel</span></a>
      <a class="admin-btn" href="/admin/add-event"><span class="lang-en">Add Event/Program</span><span class="lang-es">Agregar Evento/Programa</span></a>
      <a class="admin-btn" href="/manageevents"><span class="lang-en">Manage Events</span><span class="lang-es">Administrar Eventos</span></a>
      <a class="admin-btn" href="/admin/manageusers"><span class="lang-en">Manage Users</span><span class="lang-es">Administrar Usuarios</span></a>
      <a class="admin-btn" href="/admin/survey-responses"><span class="lang-en">Manage Surveys</span><span class="lang-es">Administrar Encuestas</span></a>
      <a class="admin-btn" href="/admin/managedonations"><span class="lang-en">Manage Donations</span><span class="lang-es">Administrar Donaciones</span></a>
  </aside>


  <!-- Main -->
  <main class="admin-main">

      <% if (success_message) { %>
        <div class="success"><%= success_message %></div>
      <% } %>

      <h2 class="page-title-sm">
        <span class="lang-en">Edit Event</span>
        <span class="lang-es">Editar Evento</span>
      </h2>

      <% if (!event) { %>
        <p><span class="lang-en">Event not found.</span><span class="lang-es">No se encontr√≥ el evento.</span></p>
      <% } else { %>


      <!-- EVENT DETAILS -->
      <form action="/admin/event/<%= event.eventid %>/edit"
            method="POST"
            class="compact-card">

          <h3 class="section-title-sm">
            <span class="lang-en">Event Details</span>
            <span class="lang-es">Detalles</span>
          </h3>

          <div class="compact-grid">
            <div>
              <label>Name</label>
              <input type="text" name="eventname" value="<%= event.eventname %>" required>
            </div>

            <div>
              <label>Type</label>
              <input type="text" name="eventtype" value="<%= event.eventtype %>" required>
            </div>
          </div>

          <label>Description</label>
          <textarea name="eventdescription" rows="2" required><%= event.eventdescription %></textarea>

          <label>Recurrence Pattern</label>
          <select name="recurrencepattern">
              <option value="None"   <%= event.recurrencepattern === 'None'   ? 'selected' : '' %>>None</option>
              <option value="Daily"  <%= event.recurrencepattern === 'Daily'  ? 'selected' : '' %>>Daily</option>
              <option value="Weekly" <%= event.recurrencepattern === 'Weekly' ? 'selected' : '' %>>Weekly</option>
              <option value="Monthly"<%= event.recurrencepattern === 'Monthly'? 'selected' : '' %>>Monthly</option>
          </select>

          <button class="edit-btn compact-btn" type="submit">Save</button>
      </form>


      <!-- DELETE -->
      <form action="/admin/event/<%= event.eventid %>/delete"
            method="POST"
            class="compact-card"
            onsubmit="return confirm('Delete this event and all its occurrences?');">

          <button class="danger-btn compact-btn" type="submit">Delete Event</button>
      </form>


      <!-- OCCURRENCES HEADER -->
      <div class="occurrence-header-sm">
        <h3>
          <span class="lang-en">Occurrences</span>
          <span class="lang-es">Fechas</span>
        </h3><br>
        <a href="/admin/event/<%= event.eventid %>/new-occurrence" class="admin-btn compact-btn">Add Occurrence</a>
      </div>

      <!-- OCCURRENCE LIST -->
      <% event.occurrences.forEach((occ) => { %>

        <form action="/admin/event-occurrence/<%= occ.eventoccurrenceid %>/edit"
              method="POST"
              class="compact-card">

          <div class="compact-grid-2">
            <div>
              <label>Start Date</label>
              <input type="date" name="eventdatestart" value="<%= occ.eventdatestart.toISOString().slice(0,10) %>" required>
            </div>

            <div>
              <label>Start Time</label>
              <input type="time" name="eventtimestart" value="<%= occ.eventtimestart %>" required>
            </div>

            <div>
              <label>End Date</label>
              <input type="date" name="eventdateend" value="<%= occ.eventdateend.toISOString().slice(0,10) %>" required>
            </div>

            <div>
              <label>End Time</label>
              <input type="time" name="eventtimeend" value="<%= occ.eventtimeend %>" required>
            </div>

            <div>
              <label>Location</label>
              <input type="text" name="eventlocation" value="<%= occ.eventlocation %>" required>
            </div>

            <div>
              <label>Capacity</label>
              <input type="number" name="eventcapacity" min="1" value="<%= occ.eventcapacity %>" required>
            </div>

            <div>
              <label>Deadline Date</label>
              <input type="date" name="eventregistrationdeadlinedate"
                     value="<%= occ.eventregistrationdeadlinedate.toISOString().slice(0,10) %>" required>
            </div>

            <div>
              <label>Deadline Time</label>
              <input type="time" name="eventregistrationdeadlinetime"
                     value="<%= occ.eventregistrationdeadlinetime %>" required>
            </div>
          </div>

          <button class="edit-btn compact-btn" type="submit">Save</button>
        </form>

        <div class="occurrence-actions">
            <a class="occ-btn-checkin" 
              href="/admin/events/checkin/<%= occ.eventoccurrenceid %>">
                Check In
            </a>

            <form action="/admin/event-occurrence/<%= occ.eventoccurrenceid %>/delete"
                  method="POST"
                  onsubmit="return confirm('Delete this occurrence?');">
                <button class="danger-btn compact-btn" type="submit">
                  Delete Occurrence
                </button>
            </form>
        </div>

      <% }) %>

      <% } %>

  </main>

</div>

<%- include('../partials/footer') %>