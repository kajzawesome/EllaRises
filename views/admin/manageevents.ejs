<%- include('../partials/header', { title: 'Manage Events', user: user, lang: lang }) %>

<div class="admin-container">
  <aside class="admin-sidebar">
    <h3><span class="lang-en">Admin Tools</span><span class="lang-es">Herramientas Admin</span></h3>
    <a class="admin-btn" href="/admin"> <span class="lang-en">Dashboard</span><span class="lang-es">Panel</span></a>
    <a class="admin-btn" href="/admin/add-event"> <span class="lang-en">Add Event/Program</span><span class="lang-es">Agregar Evento/Programa</span></a>
    <a class="admin-btn" href="/admin/manage-users"> <span class="lang-en">Manage Users</span><span class="lang-es">Administrar Usuarios</span></a>
  </aside>

  <main class="admin-main">
    <section>
      <h2><span class="lang-en">Events & Programs</span><span class="lang-es">Eventos y Programas</span></h2>

      <% if (events && events.length) { %>
        <% events.forEach(ev => { %>
          <div class="admin-item-card">
            <div style="flex:1;">
              <h3><%= ev.eventname %> <small style="color:#666">(<%= ev.eventtype %>)</small></h3>
              <p><%= ev.eventdescription %></p>
              <p><strong><span class="lang-en">Recurrence:</span><span class="lang-es">Recurrencia:</span></strong> <%= ev.recurrencepattern || '—' %></p>

              <% if (ev.occurrences && ev.occurrences.length) { %>
                <div style="margin-top:10px;">
                  <strong><span class="lang-en">Upcoming Occurrences:</span><span class="lang-es">Próximas Fechas:</span></strong>
                  <ul>
                    <% ev.occurrences.forEach(o => { %>
                      <li>
                        <%= o.eventdatestart %> <%= o.eventtimestart %> – <%= o.eventdateend %> <%= o.eventtimeend %>
                        @ <%= o.eventlocation %>
                        (<%= o.eventcapacity %> cap)
                        <a href="/admin/event-occurrence/edit/<%= o.eventoccurenceID %>" class="edit-btn" style="margin-left:8px;"><span class="lang-en">Edit</span><span class="lang-es">Editar</span></a>
                        <form style="display:inline" action="/admin/event-occurrence/delete/<%= o.eventoccurenceID %>" method="POST" onsubmit="return confirm('Delete this occurrence?');">
                          <button class="admin-btn" type="submit"><span class="lang-en">Delete</span><span class="lang-es">Eliminar</span></button>
                        </form>
                        <a href="/admin/event-occurrence/registrants/<%= o.eventoccurenceID %>" class="admin-btn" style="margin-left:6px;"> <span class="lang-en">View Registrants</span><span class="lang-es">Ver Inscritas</span></a>
                      </li>
                    <% }) %>
                  </ul>
                </div>
              <% } %>
            </div>

            <div style="display:flex; flex-direction:column; gap:8px; align-items:flex-end;">
              <a class="edit-btn" href="/admin/event/edit/<%= ev.eventID %>"><span class="lang-en">Edit Event</span><span class="lang-es">Editar Evento</span></a>
              <form action="/admin/event/delete/<%= ev.eventID %>" method="POST" onsubmit="return confirm('Delete this event and occurrences?');">
                <button class="admin-btn" type="submit"><span class="lang-en">Delete</span><span class="lang-es">Eliminar</span></button>
              </form>
              <a class="admin-btn" href="/admin/event/<%= ev.eventID %>/new-occurrence"><span class="lang-en">Add Occurrence</span><span class="lang-es">Agregar Fecha</span></a>
            </div>
          </div>
        <% }) %>
      <% } else { %>
        <p><span class="lang-en">No events found.</span><span class="lang-es">No se encontraron eventos.</span></p>
      <% } %>
    </section>
  </main>
</div>

<%- include('../partials/footer') %>
