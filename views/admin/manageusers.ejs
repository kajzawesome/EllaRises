<%- include('partials/header', { 
    title: title,
    user: user,
    lang: lang
}) %>

<title><%= title || "Manage Users" %></title>

<div class="admin-page">
    <h1 class="page-title">Manage Users</h1>

    <!-- Add Manager Button: for now managers will be added in the sql directly since there are so few
    <form action="/addUser" method="GET" class="top-action">
        <button type="submit" class="admin-btn">Add Manager</button>
    </form>
    -->

    <!-- Error Message -->
    <% if (error_message) { %>
        <div class="alert error"><%= error_message %></div>
    <% } %> 

    <!-- ============ MANAGERS ============ -->
    <section>
        <h2>Managers</h2>

        <% if (managers.length === 0) { %>
            <div class="alert info">No managers found in the database.</div>
        <% } else { %>
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>First</th>
                        <th>Last</th>
                        <th>Options</th>
                    </tr>
                </thead>

                <tbody>
                    <% managers.forEach(m => { %>
                        <tr>
                            <td><%= m.managerfirstname %></td>
                            <td><%= m.managerlastname %></td>
                            <td class="row-actions">
                                <!-- VIEW DETAILS -->
                                <a class="view-btn" href="/admin/user/<%= m.userid %>">
                                    View Details
                                </a>

                                <!-- EDIT MANAGER -->
                                <form action="/editUser/<%= m.userid %>" method="GET">
                                    <button type="submit" class="edit-btn">Edit</button>
                                </form>

                                <!-- DELETE MANAGER -->
                                <form 
                                    action="/deleteUser/<%= m.userid %>" 
                                    method="POST"
                                    onsubmit="return confirm('Delete <%= m.managerfirstname %>?');">
                                    <button type="submit" class="delete-btn">Delete</button>
                                </form>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        <% } %>
    </section>

    <!-- ============ PARENT ACCOUNTS ============ -->
    <section>
        <h2>Parent Accounts</h2>

        <% if (parents.length === 0) { %>
            <div class="alert info">No parent accounts found.</div>
        <% } else { %>
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Preferred Language</th>
                        <th>Options</th>
                    </tr>
                </thead>

                <tbody>
                    <% parents.forEach(p => { %>
                        <tr>
                            <td><%= p.parentfirstname %> <%= p.parentlastname %></td>
                            <td><%= p.parentemail %></td>
                            <td><%= p.preferredlanguage %></td>

                            <td class="row-actions">
                                <!-- VIEW PROFILE -->
                                <a class="view-btn" href="/admin/user/<%= p.userid %>">
                                    View Details
                                </a>

                                <!-- DELETE -->
                                <form 
                                    action="/deleteUser/<%= p.userid %>" 
                                    method="POST"
                                    onsubmit="return confirm('Delete this parent account?');">
                                    <button class="delete-btn" type="submit">Delete</button>
                                </form>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        <% } %>
    </section>
</div>

<%- include('partials/footer') %>
