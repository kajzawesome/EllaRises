<%- include('../partials/header', { title: 'Survey Responses' }) %>

<div class="admin-container">

    <aside class="admin-sidebar">
        <h3><span class="lang-en">Admin Tools</span><span class="lang-es">Herramientas Admin</span></h3>
        <a class="admin-btn" href="/admin/dashboard"> <span class="lang-en">Dashboard</span><span class="lang-es">Panel</span></a>
        <a class="admin-btn" href="/admin/add-event"> <span class="lang-en">Add Event/Program</span><span class="lang-es">Agregar Evento/Programa</span></a>
        <a class="admin-btn" href="/manageevents"> <span class="lang-en">Manage Events</span><span class="lang-es">Administrar Eventos</span></a>
        <a class="admin-btn" href="/admin/manageusers"> <span class="lang-en">Manage Users</span><span class="lang-es">Administrar Usuarios</span></a>
        <a class="admin-btn" href="/admin/survey-responses"> <span class="lang-en">Manage Surveys</span><span class="lang-es">Administrar Encuestas</span></a>
        <a class="admin-btn" href="/admin/managedonations"> <span class="lang-en">Manage Donations</span><span class="lang-es">Administrar Donaciones</span></a>
    </aside>

  <!-- MAIN CONTENT -->
  <main class="admin-main">
    <section>
      <h2>
        <span class="lang-en">Survey Responses</span>
        <span class="lang-es">Respuestas de Encuesta</span>
      </h2>

      <!-- FILTERS -->
      <div style="margin-bottom:18px;">
        <form method="GET" action="/admin/survey-responses" style="display:flex; gap:12px; flex-wrap:wrap;">

          <!-- Search -->
          <input 
            type="text" 
            name="search"
            value="<%= search || '' %>"
            placeholder="Search participant or comments..."
            class="input"
            style="padding:6px 10px; min-width:200px;"
          >

          <!-- Event Filter -->
          <select name="filterValue" class="input">
            <option value="">
              <span class="lang-en">All Events</span>
              <span class="lang-es">Todos los Eventos</span>
            </option>
            <% filterOptions.forEach(f => { %>
              <option value="<%= f.id %>" <%= filterBy == f.id ? "selected" : "" %>>
                <span class="lang-en"><%= f.label_en %></span>
                <span class="lang-es"><%= f.label_es %></span>
              </option>
            <% }) %>
          </select>

          <!-- Score Filter -->
          <select name="scoreOperator" class="input">
            <option value=">=">&ge;</option>
            <option value="<=">&le;</option>
            <option value="=">=</option>
          </select>

          <input 
            type="number"
            name="scoreValue"
            value="<%= scoreValue || '' %>"
            placeholder="Score"
            class="input"
          >

          <button class="button" type="submit">
            <span class="lang-en">Filter</span>
            <span class="lang-es">Filtrar</span>
          </button>
        </form>
      </div>

      <!-- RESULTS -->
      <% if (responses && responses.length > 0) { %>

      <!-- TABLE -->
      <table style="width:100%; border-collapse:collapse;">
        <thead>
          <tr style="text-align:left; background:#f2f2f2;">
            <th>ID</th>
            <th><span class="lang-en">Participant</span><span class="lang-es">Participante</span></th>
            <th><span class="lang-en">Event</span><span class="lang-es">Evento</span></th>
            <th><span class="lang-en">Type</span><span class="lang-es">Tipo</span></th>
            <th><span class="lang-en">Description</span><span class="lang-es">Descripción</span></th>
            <th><span class="lang-en">Location</span><span class="lang-es">Ubicación</span></th>
            <th><span class="lang-en">Satisfaction</span><span class="lang-es">Satisfacción</span></th>
            <th><span class="lang-en">Usefulness</span><span class="lang-es">Utilidad</span></th>
            <th><span class="lang-en">Instructor</span><span class="lang-es">Instructor</span></th>
            <th><span class="lang-en">Recommendation</span><span class="lang-es">Recomendación</span></th>
            <th><span class="lang-en">Overall</span><span class="lang-es">General</span></th>
            <th><span class="lang-en">Comments</span><span class="lang-es">Comentarios</span></th>
            <th><span class="lang-en">Submitted</span><span class="lang-es">Enviada</span></th>
            <th></th>
            <th></th>
          </tr>
        </thead>

        <tbody>
          <% responses.forEach(r => { %>
            <tr>
              <td><%= r.id %></td>

              <td><%= r.user_label %></td>

              <td><%= r.eventname %></td>

              <td><%= r.eventtype %></td>

              <td><%= r.eventdescription %></td>

              <td><%= r.eventlocation %></td>

              <td><%= r.SurveySatisfactionScore %></td>

              <td><%= r.SurveyUsefulnessScore %></td>

              <td><%= r.SurveyInstructorScore %></td>

              <td><%= r.SurveyRecommendationScore %></td>

              <td><%= r.SurveyOverallScore %></td>

              <td><%= r.SurveyComments || "—" %></td>

              <td><%= r.SurveySubmissionDate %> <%= r.SurveySubmissionTime %></td>

              <!-- EDIT -->
              <td>
                <a class="button" href="/survey/fill/<%= r.id %>">
                  <span class="lang-en">Edit</span>
                  <span class="lang-es">Editar</span>
                </a>
              </td>

              <!-- DELETE -->
              <td>
                <form 
                  method="POST"
                  action="/admin/survey/delete/<%= r.id %>"
                  onsubmit="return confirm('Delete this survey response?');"
                >
                  <button class="button button-danger" type="submit">
                    <span class="lang-en">Delete</span>
                    <span class="lang-es">Eliminar</span>
                  </button>
                </form>
              </td>

            </tr>
          <% }) %>
        </tbody>
      </table>

      <% } else { %>
        <p>
          <span class="lang-en">No survey responses found.</span>
          <span class="lang-es">No hay respuestas de encuesta.</span>
        </p>
      <% } %>

    </section>
  </main>
</div>

<%- include('../partials/footer') %>