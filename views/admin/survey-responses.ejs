<%- include('../partials/header', { title: 'Survey Responses' }) %>

<div class="admin-container">

    <!-- SIDEBAR -->
    <aside class="admin-sidebar">
        <h3><span class="lang-en">Admin Tools</span><span class="lang-es">Herramientas Admin</span></h3>

        <a class="admin-btn" href="/admin/dashboard">
            <span class="lang-en">Dashboard</span><span class="lang-es">Panel</span>
        </a>

        <a class="admin-btn" href="/admin/add-event">
            <span class="lang-en">Add Event/Program</span><span class="lang-es">Agregar Evento/Programa</span>
        </a>

        <a class="admin-btn" href="/manageevents">
            <span class="lang-en">Manage Events</span><span class="lang-es">Administrar Eventos</span>
        </a>

        <a class="admin-btn" href="/admin/manageusers">
            <span class="lang-en">Manage Users</span><span class="lang-es">Administrar Usuarios</span>
        </a>

        <a class="admin-btn" href="/admin/survey-responses">
            <span class="lang-en">Manage Surveys</span><span class="lang-es">Administrar Encuestas</span>
        </a>

        <a class="admin-btn" href="/admin/managedonations">
            <span class="lang-en">Manage Donations</span><span class="lang-es">Administrar Donaciones</span>
        </a>
    </aside>



    <!-- MAIN CONTENT -->
    <main class="admin-main">

        <h2 class="page-title">
            <span class="lang-en">Survey Responses</span>
            <span class="lang-es">Respuestas de Encuesta</span>
        </h2>



        <!-- FILTER BAR -->
        <form method="GET" action="/admin/survey-responses" class="survey-filters">

            <!-- Search -->
            <input 
                type="text" 
                name="search"
                value="<%= search || '' %>"
                placeholder="Search participant or comments..."
                class="input"
            >

            <!-- Event Filter -->
            <select name="filterValue" class="input">
                <option value="">All Events</option>
                <% filterOptions.forEach(f => { %>
                    <option value="<%= f.id %>" <%= filterBy == f.id ? "selected" : "" %>>
                        <%= f.label_en %>
                    </option>
                <% }) %>
            </select>

            <!-- Score Operator -->
            <select name="scoreOperator" class="input">
                <option value=">=">&ge;</option>
                <option value="<=">&le;</option>
                <option value="=">=</option>
            </select>

            <!-- Score Value -->
            <input 
                type="number"
                name="scoreValue"
                value="<%= scoreValue || '' %>"
                placeholder="Score"
                class="input"
            >

            <button class="button" type="submit">Filter</button>
        </form>



        <!-- RESULTS TABLE -->
        <% if (responses && responses.length > 0) { %>

            <table class="survey-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Participant</th>
                        <th>Event</th>
                        <th>Type</th>
                        <th>Description</th>
                        <th>Location</th>
                        <th>Satisfaction</th>
                        <th>Usefulness</th>
                        <th>Instructor</th>
                        <th>Recommendation</th>
                        <th>Overall</th>
                        <th>Comments</th>
                        <th>Submitted</th>
                        <th></th>
                        <th></th>
                    </tr>
                </thead>

                <tbody>
                    <% responses.forEach(r => { %>
                        <tr>
                            <td><%= r.id %></td>
                            <td><%= r.user_label %></td>
                            <td><%= r.eventname %></td>
                            <td><%= r.eventtype %></td>
                            <td><%= r.eventdescription %></td>
                            <td><%= r.eventlocation %></td>

                            <td><%= r.SurveySatisfactionScore %></td>
                            <td><%= r.SurveyUsefulnessScore %></td>
                            <td><%= r.SurveyInstructorScore %></td>
                            <td><%= r.SurveyRecommendationScore %></td>
                            <td><%= r.SurveyOverallScore %></td>

                            <td><%= r.SurveyComments || "â€”" %></td>

                            <td>
                                <%= r.SurveySubmissionDate %><br>
                                <%= r.SurveySubmissionTime %>
                            </td>

                            <!-- EDIT -->
                            <td>
                                <a class="table-action-btn" href="/survey/fill/<%= r.id %>">
                                    Edit
                                </a>
                            </td>

                            <!-- DELETE -->
                            <td>
                                <form 
                                    method="POST"
                                    action="/admin/survey/delete/<%= r.id %>"
                                    onsubmit="return confirm('Delete this survey response?');"
                                >
                                    <button class="table-action-btn table-action-btn-danger" type="submit">
                                        Delete
                                    </button>
                                </form>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>

        <% } else { %>

            <p style="text-align:center; margin-top:20px;">
                <span class="lang-en">No survey responses found.</span>
                <span class="lang-es">No hay respuestas de encuesta.</span>
            </p>

        <% } %>

    </main>

</div>

<%- include('../partials/footer') %>
