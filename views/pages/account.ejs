<%- include('../partials/header', { title: 'My Account' }) %>

<div class="admin-container">

  <!-- Sidebar (optional â€“ remove if not needed) -->
  <aside class="admin-sidebar">
      <h3>Account Tools</h3>
      <a class="admin-btn" href="/account">My Account</a>
      <a class="admin-btn" href="/logout">Logout</a>
  </aside>

  <!-- Main -->
  <main class="admin-main">

    <h2>My Account</h2>

    <!-- =============================== -->
    <!--      PARENT INFORMATION         -->
    <!-- =============================== -->
    <form action="/account/<%= parent.userid %>/update" method="POST" class="event-card">

      <h3>Parent Information</h3>

      <label>First Name</label>
      <input type="text" name="parentfirstname" value="<%= parent.parentfirstname %>" required>

      <label>Last Name</label>
      <input type="text" name="parentlastname" value="<%= parent.parentlastname %>" required>

      <label>Email</label>
      <input type="email" name="parentemail" value="<%= parent.parentemail %>" required>

      <label>Phone</label>
      <input type="text" name="parentphone" value="<%= parent.parentphone %>">

      <label>City</label>
      <input type="text" name="parentcity" value="<%= parent.parentcity %>">

      <label>State</label>
      <input type="text" name="parentstate" value="<%= parent.parentstate %>">

      <label>ZIP Code</label>
      <input type="text" name="parentzip" value="<%= parent.parentzip %>">

      <label>College</label>
      <input type="text" name="parentcollege" value="<%= parent.parentcollege %>">

      <label>Language Preference</label>
      <input type="text" name="languagepreference" value="<%= parent.languagepreference %>">

      <label>Scholarship Interest</label>
      <input type="text" name="scholarshipinterest" value="<%= parent.scholarshipinterest %>">

      <label>Tuition Agreement</label>
      <select name="tuitionagreement">
        <option value="true"  <%= parent.tuitionagreement ? "selected" : "" %>>Yes</option>
        <option value="false" <%= !parent.tuitionagreement ? "selected" : "" %>>No</option>
      </select>

      <label>Medical Consent</label>
      <select name="medicalconsent">
        <option value="true"  <%= parent.medicalconsent ? "selected" : "" %>>Yes</option>
        <option value="false" <%= !parent.medicalconsent ? "selected" : "" %>>No</option>
      </select>

      <label>Photo/Video Consent</label>
      <select name="photoconsent">
        <option value="true"  <%= parent.photoconsent ? "selected" : "" %>>Yes</option>
        <option value="false" <%= !parent.photoconsent ? "selected" : "" %>>No</option>
      </select>

      <label>Agreement Date</label>
      <input type="date" name="agreementdate"
             value="<%= parent.agreementdate ? parent.agreementdate.toISOString().split('T')[0] : '' %>">

      <button class="edit-btn" type="submit" style="margin-top:20px;">
        Save Parent Information
      </button>
    </form>


    <!-- ADD CHILD BUTTON -->
    <a href="/account/<%= parent.parentid %>/participant/add"
       class="admin-btn" style="margin-top:20px; display:inline-block;">
      Add Child
    </a>


    <!-- =============================== -->
    <!--          CHILDREN LIST          -->
    <!-- =============================== -->
    <h3 style="margin-top:35px;">Children</h3>

    <% parent.participants.forEach(child => { %>

      <form action="/account/participant/<%= child.participantid %>/update-full"
            method="POST" class="event-card">

        <h3>
          Edit Child:
          <%= child.participantfirstname %> <%= child.participantlastname %>
        </h3>

        <label>First Name</label>
        <input type="text" name="participantfirstname" value="<%= child.participantfirstname %>" required>

        <label>Last Name</label>
        <input type="text" name="participantlastname" value="<%= child.participantlastname %>" required>

        <label>Email</label>
        <input type="email" name="participantemail" value="<%= child.participantemail %>" required>

        <label>Date of Birth</label>
        <input type="date" name="participantdob"
               value="<%= child.participantdob ? child.participantdob.toISOString().split('T')[0] : "" %>">

        <label>Grade</label>
        <input type="text" name="participantgrade" value="<%= child.participantgrade %>">

        <label>School/Employer</label>
        <input type="text" name="participantschooloremployer"
               value="<%= child.participantschooloremployer %>">

        <label>Field of Interest</label>
        <input type="text" name="participantfieldofinterest"
               value="<%= child.participantfieldofinterest %>">

        <label>Instrument (Mariachi)</label>
        <input type="text" name="mariachiinstrumentinterest"
               value="<%= child.mariachiinstrumentinterest %>">

        <label>Instrument Experience</label>
        <input type="text" name="instrumentexperience"
               value="<%= child.instrumentexperience %>">

        <label>Graduation Status</label>
        <select name="graduationstatus">
          <option value="not started" <%= child.graduationstatus === "not started" ? "selected" : "" %>>Not Started</option>
          <option value="in progress" <%= child.graduationstatus === "in progress" ? "selected" : "" %>>In Progress</option>
          <option value="completed" <%= child.graduationstatus === "completed" ? "selected" : "" %>>Completed</option>
        </select>

        <button class="edit-btn" type="submit" style="margin-top:15px;">
          Save Child
        </button>

      </form>


      <!-- DELETE CHILD -->
      <form action="/account/participant/<%= child.participantid %>/delete"
            method="POST"
            onsubmit="return confirm('Delete this child and all milestones?');">
        <button class="admin-btn danger-btn" type="submit">
          Delete Child
        </button>
      </form>


      <!-- =============================== -->
      <!--           MILESTONES            -->
      <!-- =============================== -->
      <h4 style="margin-top:20px;">Milestones</h4>

      <% if (child.milestones.length === 0) { %>
        <p>No milestones yet.</p>
      <% } %>

      <% child.milestones.forEach(ms => { %>
        <form action="/account/milestone/<%= ms.milestoneid %>/update-full"
              method="POST" class="occ-edit-card">

          <label>Title</label>
          <input type="text" name="milestonetitle" value="<%= ms.milestonetitle %>" required>

          <label>Date</label>
          <input type="date" name="milestonedate"
                 value="<%= ms.milestonedate ? ms.milestonedate.toISOString().split('T')[0] : "" %>">

          <label>Status</label>
          <select name="milestonestatus">
            <option value="Not Started" <%= ms.milestonestatus === "Not Started" ? "selected" : "" %>>Not Started</option>
            <option value="In Progress" <%= ms.milestonestatus === "In Progress" ? "selected" : "" %>>In Progress</option>
            <option value="Completed" <%= ms.milestonestatus === "Completed" ? "selected" : "" %>>Completed</option>
          </select>

          <button class="edit-btn" type="submit" style="margin-top:10px;">Save Milestone</button>
        </form>

        <form action="/account/milestone/<%= ms.milestoneid %>/delete"
              method="POST"
              onsubmit="return confirm('Delete this milestone?');">
          <button class="admin-btn danger-btn" type="submit">Delete Milestone</button>
        </form>
      <% }) %>

      <a class="admin-btn" href="/account/participant/<%= child.participantid %>/milestones/add"
         style="margin-bottom:25px; display:inline-block;">
        Add Milestone
      </a>

    <% }) %>

  </main>
</div>

<%- include('../partials/footer') %>