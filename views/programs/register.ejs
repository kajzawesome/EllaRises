<%- include('partials/header') %>

    <div class="programs-page">

        <!-- ================================
         PROGRAMS CAROUSEL
         (Visible always, but order depends on language)
    ================================= -->
        <div class="carousel-container">
            <h2 class="lang-en">Programs</h2>
            <h2 class="lang-es">Programas</h2>

            <div class="carousel" id="programCarousel">

                <% sortedPrograms.forEach(p=> { %>
                    <div class="carousel-item">
                        <img src="<%= p.image %>" alt="<%= p.title_en %>">
                        <h3 class="lang-en">
                            <%= p.title_en %>
                        </h3>
                        <h3 class="lang-es">
                            <%= p.title_es %>
                        </h3>
                        <p class="lang-en">
                            <%= p.desc_en %>
                        </p>
                        <p class="lang-es">
                            <%= p.desc_es %>
                        </p>

                        <% if (user && !userProgramIds.includes(p.id)) { %>
                            <form action="/programs/register/<%= p.id %>" method="post">
                                <button class="btn-primary lang-en">Register</button>
                                <button class="btn-primary lang-es">Registrar</button>
                            </form>
                            <% } %>
                    </div>
                    <% }) %>

            </div>

            <button class="carousel-btn left" onclick="moveCarousel(-1)">&#10094;</button>
            <button class="carousel-btn right" onclick="moveCarousel(1)">&#10095;</button>
        </div>



        <!-- ================================
         PAST PROGRAMS (NEEDING SURVEY)
    ================================= -->
        <% if (user && pastPrograms.length> 0) { %>
            <section class="program-section">
                <h2 class="lang-en">Past Programs — Action Needed</h2>
                <h2 class="lang-es">Programas Pasados — Acción Necesaria</h2>

                <% pastPrograms.forEach(p=> { %>
                    <div class="program-card past">
                        <h3 class="lang-en">
                            <%= p.program.title_en %>
                        </h3>
                        <h3 class="lang-es">
                            <%= p.program.title_es %>
                        </h3>

                        <p><strong class="lang-en">Ended:</strong><strong class="lang-es">Terminado:</strong>
                            <%= p.endDateFormatted %>
                        </p>

                        <form action="/programs/survey/<%= p.id %>" method="get">
                            <button class="btn-warning lang-en">Complete Survey</button>
                            <button class="btn-warning lang-es">Completar Encuesta</button>
                        </form>
                    </div>
                    <% }); %>
            </section>
            <% } %>



                <!-- ================================
         CURRENT PROGRAMS
    ================================= -->
                <% if (user && currentPrograms.length> 0) { %>
                    <section class="program-section">
                        <h2 class="lang-en">Your Current Programs</h2>
                        <h2 class="lang-es">Sus Programas Actuales</h2>

                        <% currentPrograms.forEach(p=> { %>
                            <div class="program-card current">
                                <h3 class="lang-en">
                                    <%= p.program.title_en %>
                                </h3>
                                <h3 class="lang-es">
                                    <%= p.program.title_es %>
                                </h3>

                                <p><strong class="lang-en">Ends:</strong><strong class="lang-es">Termina:</strong>
                                    <%= p.endDateFormatted %>
                                </p>
                            </div>
                            <% }); %>
                    </section>
                    <% } %>



                        <!-- ================================
         AVAILABLE PROGRAMS (NOT JOINED)
    ================================= -->
                        <% if (user && availablePrograms.length> 0) { %>
                            <section class="program-section">
                                <h2 class="lang-en">Available Programs</h2>
                                <h2 class="lang-es">Programas Disponibles</h2>

                                <% availablePrograms.forEach(p=> { %>
                                    <div class="program-card available">

                                        <h3 class="lang-en">
                                            <%= p.title_en %>
                                        </h3>
                                        <h3 class="lang-es">
                                            <%= p.title_es %>
                                        </h3>

                                        <p class="lang-en">
                                            <%= p.desc_en %>
                                        </p>
                                        <p class="lang-es">
                                            <%= p.desc_es %>
                                        </p>

                                        <form action="/programs/register/<%= p.id %>" method="post">
                                            <button class="btn-primary lang-en">Register</button>
                                            <button class="btn-primary lang-es">Registrar</button>
                                        </form>
                                    </div>
                                    <% }); %>
                            </section>
                            <% } %>

    </div>

    <script>
        // Simple left/right carousel control
        let carouselIndex = 0;

        function moveCarousel(direction) {
            const container = document.getElementById('programCarousel');
            const items = container.querySelectorAll('.carousel-item');

            carouselIndex += direction;

            if (carouselIndex < 0) carouselIndex = items.length - 1;
            if (carouselIndex >= items.length) carouselIndex = 0;

            container.style.transform = `translateX(-${carouselIndex * 100}%)`;
        }
    </script>

    <%- include('partials/footer') %>